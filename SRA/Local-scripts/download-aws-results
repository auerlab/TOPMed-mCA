#!/bin/sh -e

if [ $(pwd) != /usr/home/bacon/Data/TOPMed/Jobs/Haplohseq-analysis/SRA ]; then
    printf "$0 must be run from Haplohseq-analysis/SRA.\n"
    exit 1
fi

dir=Haplohseq-analysis/SRA
key="-i $HOME/.ssh/aws-us-east.pem"
for ip in $(cat whi-aws-ips); do
    echo $ip
    rsync -e "ssh $key" -av --progress \
	--exclude 'VCFs-whi-samples-*/combined.*-ad.vcf.xz' \
	ec2-user@${ip}:$dir/VCFs-\* .
done

# Back up results immediately to 2 other places
rsync -avx --exclude 'VCFs-*/*.xz' \
    VCFs-* peregrine.hpc.uwm.edu:Data/TOPMed/Jobs/Haplohseq-analysis/SRA

rsync -avx -e 'ssh -p 22005' --exclude 'VCFs-*/*.xz' \
    VCFs-* mortimer.hpc.uwm.edu:/raid-05/SPH/pauer/bacon/TOPMed/Jobs/Haplohseq-analysis/SRA
