#!/bin/sh -e

##########################################################################
#   Script description:
#       Deidentify event files and link into Events dir
#       
#   History:
#   Date        Name        Modification
#   2020-08-24  Jason Bacon Begin
##########################################################################

usage()
{
    printf "Usage: $0 haplohseq-output-dir\n"
    exit 1
}


##########################################################################
#   Main
##########################################################################

if [ $# != 1 ]; then
    usage
fi
dir=$1

events_dir=$dir/De-identified-events
mkdir -p $events_dir
sn=1
for file in $(find $dir -depth 1 -name '*.events.dat'); do
    hash=$(printf "%04s" $sn)
    deident=$(basename $file | sed -E "s|NWD[0-9]+|$hash|")
    printf "$file -> $deident\n"
    ln -f $file $events_dir/$deident
    sn=$((sn + 1))
done
